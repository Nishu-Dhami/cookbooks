<#
.SYNOPSIS

Generic script to Bake a LANSA image for Azure

.DESCRIPTION
Used by Image Pipeline
.EXAMPLE


#>
param (
    [Parameter(Mandatory=$true)]
    [string]
    $VersionText,

    [Parameter(Mandatory=$true)]
    [int]
    $VersionMajor,

    [Parameter(Mandatory=$true)]
    [int]
    $VersionMinor,

    [Parameter(Mandatory=$true)]
    [string]
    $AmazonAMIName,

    [Parameter(Mandatory=$true)]
    [string]
    $GitBranch,

    [Parameter(Mandatory=$false)]
    [string]
    $Cloud='AWS',

    [Parameter(Mandatory=$false)]
    [boolean]
    $Win2012=$true,

    [Parameter(Mandatory=$false)]
    [boolean]
    $AtomicBuild=$false,

    [Parameter(Mandatory=$false)]
    [string]
    $KeyPairName="RobG_id_rsa",

    [Parameter(Mandatory=$false)]
    [string]
    $KeyPairPath="$ENV:USERPROFILE\\.ssh\\id_rsa",

    [Parameter(Mandatory=$false)]
    [string]
    $GitUserName="robe070"
    )

# $DebugPreference = "Continue"
$VerbosePreference = "Continue"

$MyInvocation.MyCommand.Path
$script:IncludeDir = Split-Path -Parent $MyInvocation.MyCommand.Path

. "$script:IncludeDir\Init-Baking-Vars.ps1"
. "$script:IncludeDir\Init-Baking-Includes.ps1"

. "$Script:IncludeDir\bake-ide-ami.ps1"

###############################################################################
# Main program logic
###############################################################################

Set-StrictMode -Version Latest
Bake-IdeMsi -VersionText $VersionText `
            -VersionMajor $VersionMajor `
            -VersionMinor $VersionMinor `
            -LocalDVDImageDirectory "\\devsrv\ReleasedBuilds\v14\SPIN0332_LanDVDcut_L4W14100_4138_160727_GA" `
            -S3DVDImageDirectory "https://lansalpcmsdn.blob.core.windows.net/releasedbuilds/v14/LanDVDcut_L4W14000_latest" `
            -S3VisualLANSAUpdateDirectory "https://lansalpcmsdn.blob.core.windows.net/releasedbuilds/v14/VisualLANSA_L4W14000_latest" `
            -S3IntegratorUpdateDirectory "https://lansalpcmsdn.blob.core.windows.net/releasedbuilds/v14/Integrator_L4W14000_latest" `
            -AmazonAMIName $AmazonAMIName `
            -GitBranch $GitBranch `
            -Cloud $Cloud `
            -InstallBaseSoftware $true `
            -InstallSQLServer $false `
            -InstallIDE $false `
            -InstallScalable $true `
            -Win2012 $Win2012 `
            -ManualWinUpd $false `
            -SkipSlowStuff $false `
            -OnlySaveImage $false `
            -CreateVM $true `
            -Pipeline:$true `
            -KeyPairName $KeyPairName `
            -KeyPairPath $KeyPairPath `
            -GitUserName $GitUserName `
            -AtomicBuild:$AtomicBuild | Out-Default | Write-Host 
            
